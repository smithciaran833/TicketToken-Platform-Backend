Schema Extraction for payment-service
Generated: 2025-10-06T16:25:08.497Z

TABLE: USD
Columns: venue_id

TABLE: activity
Columns: action, timestamp

TABLE: as
Columns: venue_id

TABLE: available
Columns: webhook_id

TABLE: bot_detections
Columns: 'SELECT NOW(, confidence, created_at, indicators, is_bot, session_id, user_agent, user_id

TABLE: database
Columns: provider_payment_id, status, updated_at

TABLE: device
Columns: DISTINCT user_id, activity_type, device_fingerprint, metadata, timestamp, user_id

TABLE: device_activity
Columns: DISTINCT user_id, activity_type, device_fingerprint, metadata, timestamp, user_id

TABLE: escrow_release_conditions
Columns: backend/services/payment-service//src/services/marketplace/price-enforcer.service.ts:163:      `SELECT * FROM resale_listings 
backend/services/payment-service//src/services/marketplace/price-enforcer.service.ts:184:      SELECT 
backend/services/payment-service//src/services/fraud/device-fingerprint.service.ts:30:    const hash = crypto.createHash('sha256', condition_type, escrow_id, hash, id, metadata, required, venue_id

TABLE: event
Columns: FILES, action, active, created_at, device_fingerprint, e, event_id, purchase_limit_per_payment_method, purchase_limit_per_user, required, seller_id, state, status, suspected_scalper_id, timestamp, updated_at, user_id, venue_id

TABLE: event_purchase_limits
Columns: event_id, purchase_limit_per_payment_method, purchase_limit_per_user, status, updated_at

TABLE: event_royalty_settings
Columns: FILES, active, created_at, device_fingerprint, e, event_id, required, seller_id, state, status, suspected_scalper_id, user_id, venue_id

TABLE: group_contribution_failures
Columns: *, failed_at, group_id, member_id, reason

TABLE: group_contributions
Columns: amount, backend/services/payment-service//src/services/group/contribution-tracker.service.ts:42:      SELECT 
backend/services/payment-service//src/services/group/contribution-tracker.service.ts:58:      SELECT 
backend/services/payment-service//src/services/group/contribution-tracker.service.ts:67:      SELECT 
backend/services/payment-service//src/services/group/contribution-tracker.service.ts:92:      `INSERT INTO group_contribution_failures 
backend/services/payment-service//src/services/group/contribution-tracker.service.ts:104:        `UPDATE group_payment_members 
backend/services/payment-service//src/services/group/contribution-tracker.service.ts:106:             updated_at = CURRENT_TIMESTAMP
backend/services/payment-service//src/services/group/contribution-tracker.service.ts:118:      `SELECT COUNT(*, contributed_at, group_id, member_id, payment_id, status

TABLE: group_payment_members
Columns: FILES, [memberId, active, amount_due, backend/services/payment-service//src/services/group/group-payment.service.ts:148:        SELECT * FROM group_payment_members 
backend/services/payment-service//src/services/group/group-payment.service.ts:168:      // Update member status
backend/services/payment-service//src/services/group/group-payment.service.ts:169:      const updateQuery = `
backend/services/payment-service//src/services/group/group-payment.service.ts:170:        UPDATE group_payment_members
backend/services/payment-service//src/services/group/group-payment.service.ts:176:      await client.query(updateQuery, created_at, device_fingerprint, e, email, event_type, groupId, group_payment_id, id, idempotency_key, name, paid, paid_at, paymentId], payment_id, reminders_sent, required, rowCount, seller_id, state, status, suspected_scalper_id, ticket_count, updateResult, updated_at, user_id, venue_id, version, webhook_id

TABLE: group_payments
Columns: FILES, active, backend/services/payment-service//src/services/group/group-payment.service.ts:62:          ticket_selections, cancellation_reason, cancelled_at, completed_at, created_at, device_fingerprint, e, event_id, event_type, expires_at, id, idempotency_key, organizer_id, paid, payment_id, required, rowCount, seller_id, state, status, status
backend/services/payment-service//src/services/group/group-payment.service.ts:72:        JSON.stringify(ticketSelections, suspected_scalper_id, ticket_selections, total_amount, updateResult, updated_at, user_id, venue_id, version, webhook_id

TABLE: inbox
Columns: webhook_id

TABLE: known
Columns: device_fingerprint, id, user_id

TABLE: known_scalpers
Columns: device_fingerprint, user_id

TABLE: orders
Columns: FILES, active, created_at, der_id, device_fingerprint, e, event_type, group_payment_id, id, idempotency_key, member_id, paid, payment_id, purchase_limit_per_payment_method, purchase_limit_per_user, required, seller_id, state, status, suspected_scalper_id, updated_at, user_id, venue_id, version, webhook_id

TABLE: outbox
Columns: ', action, aggregate_id, aggregate_type, attempts, backend/services/payment-service//src/services/event-ordering.service.ts:284:      SELECT * FROM payment_event_sequence
backend/services/payment-service//src/services/event-ordering.service.ts:330:    return crypto.createHash('sha256', backend/services/payment-service//src/services/high-demand/purchase-limiter.service.ts:132:      `SELECT
backend/services/payment-service//src/services/high-demand/purchase-limiter.service.ts:165:      `SELECT SUM(ticket_count, backend/services/payment-service//src/services/reconciliation/reconciliation-service.ts:129:          UPDATE outbox
backend/services/payment-service//src/services/reconciliation/reconciliation-service.ts:153:        UPDATE outbox
backend/services/payment-service//src/services/reconciliation/reconciliation-service.ts:184:        SELECT o.*, backend/services/payment-service//src/services/reconciliation/reconciliation-service.ts:233:            UPDATE orders
backend/services/payment-service//src/services/reconciliation/reconciliation-service.ts:235:                updated_at = NOW(, created_at, der_id, event_type, id, joined, last_attempt_at, last_error, original_id, payload, pi.status as payment_status
backend/services/payment-service//src/services/reconciliation/reconciliation-service.ts:194:          // Payment succeeded but order not updated
backend/services/payment-service//src/services/reconciliation/reconciliation-service.ts:198:            UPDATE orders
backend/services/payment-service//src/services/reconciliation/reconciliation-service.ts:200:                updated_at = NOW(, state, status, tenant_id, updated_at

TABLE: payment_escrows
Columns: EscrowStatus.FUNDED, FILES, active, amount, backend/services/payment-service//src/services/marketplace/escrow.service.ts:104:      await this.updateEscrowStatus(escrowId, buyer_id, created_at, device_fingerprint, e, hash, id, listing_id, platform_fee, seller_id, seller_payout, state, status, stripe_payment_intent_id, suspected_scalper_id, updated_at, user_id, venue_id, venue_royalty

TABLE: payment_event_sequence
Columns: attempts, backend/services/payment-service//src/services/event-ordering.service.ts:161:      SELECT MAX(sequence_number, created_at, error, event_timestamp, event_type, idempotency_key, order_id, payload, payment_id, sequence_number, status, stripe_event_id, updated_at, venue_id, webhook_id

TABLE: payment_idempotency
Columns: EscrowStatus.FUNDED, FILES, active, backend/services/payment-service//src/services/marketplace/royalty-splitter.service.ts:128:      SELECT 
backend/services/payment-service//src/services/marketplace/royalty-splitter.service.ts:142:      SELECT 
backend/services/payment-service//src/services/marketplace/escrow.service.ts:57:        INSERT INTO payment_escrows (
backend/services/payment-service//src/services/marketplace/escrow.service.ts:104:      await this.updateEscrowStatus(escrowId, created_at, device_fingerprint, e, expires_at, idempotency_key, operation, request_hash, required, response, seller_id, state, status, status_code, suspected_scalper_id, user_id, venue_id, webhook_id

TABLE: payment_intents
Columns: FILES, active, aggregate_id, aggregate_type, amount, attempts, created_at, der_id, device_fingerprint, e, error, event_type, id, idempotency_key, metadata, order_id, payload, payment_id, platform_fee, required, rowCount, seller_id, state, status, stripe_intent_id, suspected_scalper_id, tenant_id, updateResult, updated_at, user_id, venue_id, version, webhook_id

TABLE: payment_state_machine
Columns: event_type, from_state, stripe_intent_id, to_state, updated_at

TABLE: payment_transactions
Columns: amount, created_at, device_fingerprint, event_id, malized_address, payment_method_fingerprint, state, status, user_id

TABLE: payments
Columns: FILES, active, created_at, device_fingerprint, e, event_type, group_payment_id, id, idempotency_key, member_id, paid, payment_id, provider_payment_id, required, retry_count, seller_id, state, status, suspected_scalper_id, updated_at, user_id, venue_id, version, webhook_id

TABLE: pending
Columns: 

TABLE: pep_database
Columns: der_id, id, state, status, updated_at, user_id

TABLE: purchase_limit_violations
Columns: event_id

TABLE: queue
Columns: action, timestamp

TABLE: reminder_history
Columns: backend/services/payment-service//src/services/group/group-payment.service.ts:48:      const totalTickets = ticketSelections.reduce(
backend/services/payment-service//src/services/group/group-payment.service.ts:60:        INSERT INTO group_payments (
backend/services/payment-service//src/services/group/group-payment.service.ts:62:          ticket_selections, expires_at, group_id, member_id, reminder_number, sent_at, status
backend/services/payment-service//src/services/group/group-payment.service.ts:72:        JSON.stringify(ticketSelections, venue_id

TABLE: resale_listings
Columns: created_at, der_id, id, seller_id, sold_at, state, status, updated_at, venue_id

TABLE: rl
Columns: tax_year, user_id

TABLE: royalty_distributions
Columns: EscrowStatus.FUNDED, amount, backend/services/payment-service//src/services/marketplace/escrow.service.ts:104:      await this.updateEscrowStatus(escrowId, percentage, recipient_id, recipient_type, transaction_id

TABLE: sanctions_list_matches
Columns: active, der_id, id, state, status, updated_at, user_id

TABLE: scalper_reports
Columns: *, created_at, evidence, reporter_id, status, suspected_scalper_id

TABLE: tax_forms_
Columns: backend/services/payment-service//src/services/reconciliation/reconciliation-service.ts:129:          UPDATE outbox
backend/services/payment-service//src/services/reconciliation/reconciliation-service.ts:153:        UPDATE outbox
backend/services/payment-service//src/services/reconciliation/reconciliation-service.ts:184:        SELECT o.*, der_id, form_data, generated_at, id, pi.status as payment_status
backend/services/payment-service//src/services/reconciliation/reconciliation-service.ts:194:          // Payment succeeded but order not updated
backend/services/payment-service//src/services/reconciliation/reconciliation-service.ts:198:            UPDATE orders
backend/services/payment-service//src/services/reconciliation/reconciliation-service.ts:200:                updated_at = NOW(, state, status, tax_year, total_proceeds, transaction_count, updated_at, user_id

TABLE: this
Columns: created_at, status, user_id

TABLE: tickets
Columns: der_id, id, state, updated_at

TABLE: transactions
Columns: FILES, active, amount, created_at, currency, device_fingerprint, e, event_id, event_type, gas_fee_paid, group_payment_id, id, idempotency_key, member_id, metadata, paid, payment_id, platform_fee, required, seller_id, state, status, status: TransactionStatus, stripe_payment_intent_id, suspected_scalper_id, tax_amount, tenant_id, total_amount, updated_at, user_id, venue_id, venue_payout, version, webhook_id

TABLE: unusual
Columns: created_at, status, user_id

TABLE: users
Columns: id, state, updated_at

TABLE: venue
Columns: FILES, active, amount, balance_type, created_at, device_fingerprint, e, hash, required, seller_id, state, status, suspected_scalper_id, user_id, venue_id

TABLE: venue_balances
Columns: amount, balance_type, venue_id

TABLE: venue_price_rules
Columns: FILES, active, created_at, device_fingerprint, e, hash, seller_id, state, status, suspected_scalper_id, user_id, venue_id

TABLE: venue_royalty_settings
Columns: FILES, active, created_at, device_fingerprint, e, required, seller_id, state, status, suspected_scalper_id, user_id, venue_id

TABLE: waiting_room_activity
Columns: *, action, event_id, metadata, timestamp, user_id

TABLE: webhook_inbox
Columns: FILES, active, attempts, created_at, device_fingerprint, e, error, event_type, group_payment_id, id, idempotency_key, member_id, paid, payload, payment_id, processed, provider, provider_payment_id, required, retry_count, seller_id, signature, source, state, status, suspected_scalper_id, updated_at, user_id, venue_id, version, webhook_id

