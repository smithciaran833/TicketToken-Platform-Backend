{
  "service": "auth-service",
  "timestamp": "2025-12-21T01:18:50.609Z",
  "summary": {
    "totalFindings": 133,
    "bySeverity": {
      "CRITICAL": 55,
      "HIGH": 52,
      "MEDIUM": 26,
      "LOW": 0
    },
    "byCategory": {
      "inputValidation": 67,
      "security": 66
    }
  },
  "findings": {
    "inputValidation": [
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 48,
        "code": "fastify.post('/register', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 57,
        "code": "fastify.post('/login', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 74,
        "code": "fastify.post('/forgot-password', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 83,
        "code": "fastify.post('/reset-password', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 100,
        "code": "fastify.get('/verify-email', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 109,
        "code": "fastify.post('/refresh', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 122,
        "code": "fastify.post('/oauth/:provider/callback', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 151,
        "code": "fastify.post('/oauth/:provider/login', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 176,
        "code": "fastify.post('/wallet/nonce', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 183,
        "code": "fastify.post('/wallet/register', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 190,
        "code": "fastify.post('/wallet/login', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 202,
        "code": "fastify.post('/biometric/challenge', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 213,
        "code": "fastify.post('/biometric/authenticate', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 252,
        "code": "fastify.get('/verify', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 261,
        "code": "fastify.get('/me', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 270,
        "code": "fastify.post('/logout', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 279,
        "code": "fastify.post('/resend-verification', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 288,
        "code": "fastify.put('/change-password', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 300,
        "code": "fastify.post('/mfa/setup', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 308,
        "code": "fastify.post('/mfa/verify-setup', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 316,
        "code": "fastify.post('/mfa/verify', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 324,
        "code": "fastify.post('/mfa/regenerate-backup-codes', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 332,
        "code": "fastify.delete('/mfa/disable', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 344,
        "code": "fastify.post('/wallet/link', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 351,
        "code": "fastify.delete('/wallet/unlink/:publicKey', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 364,
        "code": "fastify.post('/biometric/register', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 387,
        "code": "fastify.get('/biometric/challenge', async (request: any, reply: any) => {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 393,
        "code": "fastify.get('/biometric/devices', async (request: any, reply: any) => {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 399,
        "code": "fastify.delete('/biometric/devices/:credentialId', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 421,
        "code": "fastify.post('/oauth/:provider/link', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 432,
        "code": "fastify.delete('/oauth/:provider/unlink', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 446,
        "code": "fastify.get('/sessions', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 456,
        "code": "fastify.delete('/sessions/all', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 464,
        "code": "fastify.delete('/sessions/:sessionId', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 477,
        "code": "fastify.get('/profile', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 485,
        "code": "fastify.put('/profile', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 497,
        "code": "fastify.post('/venues/:venueId/roles', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 515,
        "code": "fastify.delete('/venues/:venueId/roles/:userId', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD1",
        "description": "Route without schema validation",
        "file": "src/routes/auth.routes.ts",
        "line": 532,
        "code": "fastify.get('/venues/:venueId/roles', {",
        "severity": "HIGH"
      },
      {
        "checkId": "RD2",
        "description": "Schema without .unknown(false) - allows extra fields (mass assignment risk)",
        "file": "src/validators/auth.validators.ts",
        "line": 56,
        "code": "export const setupMFASchema",
        "severity": "HIGH"
      },
      {
        "checkId": "RD2",
        "description": "Schema without .unknown(false) - allows extra fields (mass assignment risk)",
        "file": "src/validators/auth.validators.ts",
        "line": 215,
        "code": "export const emptyBodySchema",
        "severity": "HIGH"
      },
      {
        "checkId": "RD3",
        "description": "String field without maxLength constraint",
        "file": "src/validators/auth.validators.ts",
        "line": 13,
        "code": "tenant_id: Joi.string().uuid().required().messages({",
        "severity": "MEDIUM"
      },
      {
        "checkId": "RD3",
        "description": "String field without maxLength constraint",
        "file": "src/validators/auth.validators.ts",
        "line": 23,
        "code": "mfaToken: Joi.string().length(6).optional(),",
        "severity": "MEDIUM"
      },
      {
        "checkId": "RD3",
        "description": "String field without maxLength constraint",
        "file": "src/validators/auth.validators.ts",
        "line": 59,
        "code": "token: Joi.string().length(6).required(),",
        "severity": "MEDIUM"
      },
      {
        "checkId": "RD3",
        "description": "String field without maxLength constraint",
        "file": "src/validators/auth.validators.ts",
        "line": 64,
        "code": "token: Joi.string().length(6).required(),",
        "severity": "MEDIUM"
      },
      {
        "checkId": "RD3",
        "description": "String field without maxLength constraint",
        "file": "src/validators/auth.validators.ts",
        "line": 73,
        "code": "chain: Joi.string().valid('solana', 'ethereum').required(),",
        "severity": "MEDIUM"
      },
      {
        "checkId": "RD3",
        "description": "String field without maxLength constraint",
        "file": "src/validators/auth.validators.ts",
        "line": 80,
        "code": "chain: Joi.string().valid('solana', 'ethereum').required(),",
        "severity": "MEDIUM"
      },
      {
        "checkId": "RD3",
        "description": "String field without maxLength constraint",
        "file": "src/validators/auth.validators.ts",
        "line": 81,
        "code": "tenant_id: Joi.string().uuid().required(),",
        "severity": "MEDIUM"
      },
      {
        "checkId": "RD3",
        "description": "String field without maxLength constraint",
        "file": "src/validators/auth.validators.ts",
        "line": 88,
        "code": "chain: Joi.string().valid('solana', 'ethereum').required(),",
        "severity": "MEDIUM"
      },
      {
        "checkId": "RD3",
        "description": "String field without maxLength constraint",
        "file": "src/validators/auth.validators.ts",
        "line": 95,
        "code": "chain: Joi.string().valid('solana', 'ethereum').required(),",
        "severity": "MEDIUM"
      },
      {
        "checkId": "RD3",
        "description": "String field without maxLength constraint",
        "file": "src/validators/auth.validators.ts",
        "line": 100,
        "code": "walletType: Joi.string().valid('phantom', 'solflare', 'metamask').required(),",
        "severity": "MEDIUM"
      },
      {
        "checkId": "RD3",
        "description": "String field without maxLength constraint",
        "file": "src/validators/auth.validators.ts",
        "line": 110,
        "code": "biometricType: Joi.string().valid('faceId', 'touchId', 'fingerprint').optional(),",
        "severity": "MEDIUM"
      },
      {
        "checkId": "RD3",
        "description": "String field without maxLength constraint",
        "file": "src/validators/auth.validators.ts",
        "line": 114,
        "code": "userId: Joi.string().uuid().required(),",
        "severity": "MEDIUM"
      },
      {
        "checkId": "RD3",
        "description": "String field without maxLength constraint",
        "file": "src/validators/auth.validators.ts",
        "line": 118,
        "code": "userId: Joi.string().uuid().required(),",
        "severity": "MEDIUM"
      },
      {
        "checkId": "RD3",
        "description": "String field without maxLength constraint",
        "file": "src/validators/auth.validators.ts",
        "line": 119,
        "code": "credentialId: Joi.string().uuid().required(),",
        "severity": "MEDIUM"
      },
      {
        "checkId": "RD3",
        "description": "String field without maxLength constraint",
        "file": "src/validators/auth.validators.ts",
        "line": 132,
        "code": "tenant_id: Joi.string().uuid().optional(),",
        "severity": "MEDIUM"
      },
      {
        "checkId": "RD3",
        "description": "String field without maxLength constraint",
        "file": "src/validators/auth.validators.ts",
        "line": 163,
        "code": "userId: Joi.string().uuid().required(),",
        "severity": "MEDIUM"
      },
      {
        "checkId": "RD3",
        "description": "String field without maxLength constraint",
        "file": "src/validators/auth.validators.ts",
        "line": 172,
        "code": "provider: Joi.string()",
        "severity": "MEDIUM"
      },
      {
        "checkId": "RD3",
        "description": "String field without maxLength constraint",
        "file": "src/validators/auth.validators.ts",
        "line": 182,
        "code": "sessionId: Joi.string().uuid().required()",
        "severity": "MEDIUM"
      },
      {
        "checkId": "RD3",
        "description": "String field without maxLength constraint",
        "file": "src/validators/auth.validators.ts",
        "line": 186,
        "code": "venueId: Joi.string().uuid().required()",
        "severity": "MEDIUM"
      },
      {
        "checkId": "RD3",
        "description": "String field without maxLength constraint",
        "file": "src/validators/auth.validators.ts",
        "line": 190,
        "code": "userId: Joi.string().uuid().required()",
        "severity": "MEDIUM"
      },
      {
        "checkId": "RD3",
        "description": "String field without maxLength constraint",
        "file": "src/validators/auth.validators.ts",
        "line": 194,
        "code": "credentialId: Joi.string().uuid().required()",
        "severity": "MEDIUM"
      },
      {
        "checkId": "RD3",
        "description": "String field without maxLength constraint",
        "file": "src/validators/auth.validators.ts",
        "line": 198,
        "code": "venueId: Joi.string().uuid().required(),",
        "severity": "MEDIUM"
      },
      {
        "checkId": "RD3",
        "description": "String field without maxLength constraint",
        "file": "src/validators/auth.validators.ts",
        "line": 199,
        "code": "userId: Joi.string().uuid().required()",
        "severity": "MEDIUM"
      },
      {
        "checkId": "RD3",
        "description": "String field without maxLength constraint",
        "file": "src/validators/auth.validators.ts",
        "line": 203,
        "code": "publicKey: Joi.string()",
        "severity": "MEDIUM"
      },
      {
        "checkId": "RD3",
        "description": "String field without maxLength constraint",
        "file": "src/validators/auth.validators.ts",
        "line": 221,
        "code": "sortBy: Joi.string().valid('created_at', 'updated_at', 'name').optional(),",
        "severity": "MEDIUM"
      },
      {
        "checkId": "RD3",
        "description": "String field without maxLength constraint",
        "file": "src/validators/auth.validators.ts",
        "line": 222,
        "code": "order: Joi.string().valid('asc', 'desc').default('desc')",
        "severity": "MEDIUM"
      }
    ],
    "security": [
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 74,
        "code": "fastify.post('/forgot-password', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 83,
        "code": "fastify.post('/reset-password', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 100,
        "code": "fastify.get('/verify-email', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 109,
        "code": "fastify.post('/refresh', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 122,
        "code": "fastify.post('/oauth/:provider/callback', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 176,
        "code": "fastify.post('/wallet/nonce', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 202,
        "code": "fastify.post('/biometric/challenge', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 252,
        "code": "fastify.get('/verify', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 261,
        "code": "fastify.get('/me', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 270,
        "code": "fastify.post('/logout', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 279,
        "code": "fastify.post('/resend-verification', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 288,
        "code": "fastify.put('/change-password', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 300,
        "code": "fastify.post('/mfa/setup', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 308,
        "code": "fastify.post('/mfa/verify-setup', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 316,
        "code": "fastify.post('/mfa/verify', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 324,
        "code": "fastify.post('/mfa/regenerate-backup-codes', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 332,
        "code": "fastify.delete('/mfa/disable', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 344,
        "code": "fastify.post('/wallet/link', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 351,
        "code": "fastify.delete('/wallet/unlink/:publicKey', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 387,
        "code": "fastify.get('/biometric/challenge', async (request: any, reply: any) => {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 393,
        "code": "fastify.get('/biometric/devices', async (request: any, reply: any) => {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 399,
        "code": "fastify.delete('/biometric/devices/:credentialId', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 421,
        "code": "fastify.post('/oauth/:provider/link', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 432,
        "code": "fastify.delete('/oauth/:provider/unlink', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 446,
        "code": "fastify.get('/sessions', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 456,
        "code": "fastify.delete('/sessions/all', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 464,
        "code": "fastify.delete('/sessions/:sessionId', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 477,
        "code": "fastify.get('/profile', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 485,
        "code": "fastify.put('/profile', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 497,
        "code": "fastify.post('/venues/:venueId/roles', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 515,
        "code": "fastify.delete('/venues/:venueId/roles/:userId', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R1",
        "description": "Route without authentication middleware",
        "file": "src/routes/auth.routes.ts",
        "line": 532,
        "code": "fastify.get('/venues/:venueId/roles', {",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-R2",
        "description": "JWT decode used instead of verify - no signature verification",
        "file": "src/services/jwt.service.ts",
        "line": 254,
        "code": "return jwt.decode(token);",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-S5",
        "description": "Database query without tenant_id filter - multi-tenant isolation risk",
        "file": "src/services/wallet.service.ts",
        "line": 220,
        "code": "'SELECT * FROM wallet_connections WHERE wallet_address = $1 AND network = $2 AND verified = true',",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-S5",
        "description": "Database query without tenant_id filter - multi-tenant isolation risk",
        "file": "src/services/wallet.service.ts",
        "line": 342,
        "code": "'SELECT user_id FROM wallet_connections WHERE wallet_address = $1 AND network = $2',",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-S5",
        "description": "Database query without tenant_id filter - multi-tenant isolation risk",
        "file": "src/services/wallet.service.ts",
        "line": 379,
        "code": "'DELETE FROM wallet_connections WHERE user_id = $1 AND wallet_address = $2',",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-S5",
        "description": "Database query without tenant_id filter - multi-tenant isolation risk",
        "file": "src/services/oauth.service.ts",
        "line": 161,
        "code": "`SELECT user_id FROM oauth_connections",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-S5",
        "description": "Database query without tenant_id filter - multi-tenant isolation risk",
        "file": "src/services/oauth.service.ts",
        "line": 240,
        "code": "`SELECT * FROM users WHERE id = $1`,",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-S5",
        "description": "Database query without tenant_id filter - multi-tenant isolation risk",
        "file": "src/services/oauth.service.ts",
        "line": 329,
        "code": "`SELECT id FROM oauth_connections",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-S5",
        "description": "Database query without tenant_id filter - multi-tenant isolation risk",
        "file": "src/services/oauth.service.ts",
        "line": 340,
        "code": "`SELECT user_id FROM oauth_connections",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-S5",
        "description": "Database query without tenant_id filter - multi-tenant isolation risk",
        "file": "src/services/oauth.service.ts",
        "line": 369,
        "code": "`DELETE FROM oauth_connections",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-S5",
        "description": "Database query without tenant_id filter - multi-tenant isolation risk",
        "file": "src/services/auth.service.ts",
        "line": 35,
        "code": "'SELECT id FROM users WHERE email = $1 AND deleted_at IS NULL',",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-S5",
        "description": "Database query without tenant_id filter - multi-tenant isolation risk",
        "file": "src/services/auth.service.ts",
        "line": 51,
        "code": "'SELECT id FROM tenants WHERE id = $1',",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-S5",
        "description": "Database query without tenant_id filter - multi-tenant isolation risk",
        "file": "src/services/auth.service.ts",
        "line": 417,
        "code": "'SELECT id, email FROM users WHERE email = $1 AND deleted_at IS NULL',",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-S5",
        "description": "Database query without tenant_id filter - multi-tenant isolation risk",
        "file": "src/services/auth.service.ts",
        "line": 465,
        "code": "'SELECT id FROM users WHERE password_reset_token = $1 AND password_reset_expires > NOW() AND deleted_at IS NULL',",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-S5",
        "description": "Database query without tenant_id filter - multi-tenant isolation risk",
        "file": "src/services/auth.service.ts",
        "line": 488,
        "code": "'SELECT password_hash FROM users WHERE id = $1 AND deleted_at IS NULL',",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-S5",
        "description": "Database query without tenant_id filter - multi-tenant isolation risk",
        "file": "src/migrations/001_auth_baseline.ts",
        "line": 66,
        "code": "IF field_name != 'updated_at' AND old_data_json->field_name IS DISTINCT FROM new_data_json->field_name THEN",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-S5",
        "description": "Database query without tenant_id filter - multi-tenant isolation risk",
        "file": "src/migrations/001_auth_baseline.ts",
        "line": 89,
        "code": "IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name = 'payment_transactions') THEN",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-S5",
        "description": "Database query without tenant_id filter - multi-tenant isolation risk",
        "file": "src/migrations/001_auth_baseline.ts",
        "line": 90,
        "code": "UPDATE users u SET total_spent = COALESCE((SELECT SUM(pt.amount) FROM payment_transactions pt WHERE pt.user_id = u.id AND pt.status = 'completed' AND pt.deleted_at IS NULL), 0);",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-S5",
        "description": "Database query without tenant_id filter - multi-tenant isolation risk",
        "file": "src/migrations/001_auth_baseline.ts",
        "line": 93,
        "code": "IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name = 'tickets') THEN",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-S5",
        "description": "Database query without tenant_id filter - multi-tenant isolation risk",
        "file": "src/migrations/001_auth_baseline.ts",
        "line": 94,
        "code": "UPDATE users u SET events_attended = COALESCE((SELECT COUNT(DISTINCT t.event_id) FROM tickets t WHERE t.user_id = u.id AND t.status IN ('used') AND t.deleted_at IS NULL), 0);",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-S5",
        "description": "Database query without tenant_id filter - multi-tenant isolation risk",
        "file": "src/migrations/001_auth_baseline.ts",
        "line": 145,
        "code": "DELETE FROM user_sessions WHERE ended_at < NOW() - INTERVAL '30 days';",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-S5",
        "description": "Database query without tenant_id filter - multi-tenant isolation risk",
        "file": "src/migrations/001_auth_baseline.ts",
        "line": 158,
        "code": "DELETE FROM wallet_connections WHERE user_id NOT IN (SELECT id FROM users);",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-S5",
        "description": "Database query without tenant_id filter - multi-tenant isolation risk",
        "file": "src/migrations/001_auth_baseline.ts",
        "line": 159,
        "code": "DELETE FROM user_sessions WHERE user_id NOT IN (SELECT id FROM users);",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-S5",
        "description": "Database query without tenant_id filter - multi-tenant isolation risk",
        "file": "src/controllers/session.controller.ts",
        "line": 122,
        "code": "`SELECT id FROM users",
        "severity": "CRITICAL"
      },
      {
        "checkId": "SEC-DB10",
        "description": "Log statement may contain sensitive data (password/token/secret)",
        "file": "src/controllers/auth.controller.ts",
        "line": 63,
        "code": "console.log('[LOGIN] MFA required, no token provided');",
        "severity": "HIGH"
      },
      {
        "checkId": "SEC-DB10",
        "description": "Log statement may contain sensitive data (password/token/secret)",
        "file": "src/controllers/auth.controller.ts",
        "line": 71,
        "code": "console.log('[LOGIN] Verifying MFA token...');",
        "severity": "HIGH"
      },
      {
        "checkId": "SEC-DB10",
        "description": "Log statement may contain sensitive data (password/token/secret)",
        "file": "src/services/auth.service.ts",
        "line": 62,
        "code": "this.log.debug('Hashing password');",
        "severity": "HIGH"
      },
      {
        "checkId": "SEC-DB10",
        "description": "Log statement may contain sensitive data (password/token/secret)",
        "file": "src/services/auth.service.ts",
        "line": 303,
        "code": "this.log.info('Token refresh attempt', { ipAddress, userAgent });",
        "severity": "HIGH"
      },
      {
        "checkId": "SEC-DB10",
        "description": "Log statement may contain sensitive data (password/token/secret)",
        "file": "src/services/auth.service.ts",
        "line": 330,
        "code": "this.log.info('Token refresh successful', { userId: user.id });",
        "severity": "HIGH"
      },
      {
        "checkId": "SEC-DB10",
        "description": "Log statement may contain sensitive data (password/token/secret)",
        "file": "src/services/auth.service.ts",
        "line": 347,
        "code": "this.log.warn('Token refresh failed', {",
        "severity": "HIGH"
      },
      {
        "checkId": "SEC-DB10",
        "description": "Log statement may contain sensitive data (password/token/secret)",
        "file": "src/services/auth.service.ts",
        "line": 409,
        "code": "this.log.info('Password reset request');",
        "severity": "HIGH"
      },
      {
        "checkId": "SEC-DB10",
        "description": "Log statement may contain sensitive data (password/token/secret)",
        "file": "src/services/auth.service.ts",
        "line": 433,
        "code": "this.log.error('Failed to send password reset email', err)",
        "severity": "HIGH"
      },
      {
        "checkId": "SEC-DB10",
        "description": "Log statement may contain sensitive data (password/token/secret)",
        "file": "src/services/auth.service.ts",
        "line": 462,
        "code": "this.log.info('Password reset attempt');",
        "severity": "HIGH"
      },
      {
        "checkId": "SEC-DB10",
        "description": "Log statement may contain sensitive data (password/token/secret)",
        "file": "src/services/auth.service.ts",
        "line": 485,
        "code": "this.log.info('Password change attempt', { userId });",
        "severity": "HIGH"
      },
      {
        "checkId": "SEC-DB10",
        "description": "Log statement may contain sensitive data (password/token/secret)",
        "file": "src/services/auth-extended.service.ts",
        "line": 274,
        "code": "console.log('All sessions invalidated due to password change for user:', userId);",
        "severity": "HIGH"
      }
    ]
  }
}