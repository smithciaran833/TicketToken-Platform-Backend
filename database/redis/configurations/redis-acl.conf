# Redis ACL Configuration for TicketToken Platform
# Phase 1: Basic Authentication

# Enable ACL log
acllog-max-len 128

# Default user with password
user default on +@all ~* &* >defaultpassword123

# Basic ACL enabled

# ============================================
# PHASE 2: SERVICE-SPECIFIC USERS
# ============================================

# Read-only monitoring user
user monitoring on +ping +info +config|get +client|list +memory|stats ~* &* >monitoring_pass_2024

# Session service user (read/write to session keys only)
user session_service on +@read +@write +@string +@hash ~session:* ~user:*:sessions >session_pass_2024

# Cache service user (read/write/delete cache data)
user cache_service on +@read +@write +@string +@hash +del +expire +ttl ~cache:* ~temp:* >cache_pass_2024

# Queue service user (list operations for job queues)
user queue_service on +@read +@write +@list +@stream ~queue:* ~jobs:* >queue_pass_2024

# ============================================
# PHASE 3: ADVANCED PERMISSIONS & SECURITY
# ============================================

# Application backend user (main app access)
user app_backend on +@all -@dangerous -flushdb -flushall -shutdown -config ~* &* >app_backend_pass_2024

# Analytics user (read-only for reporting)
user analytics on +@read +scan +keys ~stats:* ~analytics:* ~report:* >analytics_pass_2024

# Admin user (almost full access, no dangerous commands)
user admin on +@all -@dangerous -acl|setuser -acl|deluser ~* &* >admin_pass_2024

# Pub/Sub user for event streaming
user pubsub_service on +ping +publish +subscribe +psubscribe +unsubscribe +punsubscribe ~channel:* &* >pubsub_pass_2024

# Disable default user (uncomment in production)
# user default on -@all

# ============================================
# PHASE 4: ACL MANAGEMENT & BEST PRACTICES
# ============================================

# LOADING ACL CONFIGURATION:
# 1. Add to redis.conf:
#    aclfile /etc/redis/redis-acl.conf
#
# 2. Or load dynamically:
#    ACL LOAD

# ACL MANAGEMENT COMMANDS:
#
# List all users:
#   ACL LIST
#
# Show user details:
#   ACL GETUSER username
#
# Test user permissions:
#   AUTH username password
#   PING
#
# View ACL log:
#   ACL LOG
#
# Save ACL to file:
#   ACL SAVE

# BEST PRACTICES:
# 1. Use strong passwords (minimum 32 characters)
# 2. Rotate passwords regularly
# 3. Never use default user in production
# 4. Audit ACL logs regularly
# 5. Use key patterns to limit access scope
# 6. Test permissions before deploying

# CONNECTION EXAMPLES:
#
# Connect as session service:
#   redis-cli --user session_service --pass session_pass_2024
#
# Connect as monitoring:
#   redis-cli --user monitoring --pass monitoring_pass_2024
#
# Test key access:
#   SET session:123 "test"  # Should work for session_service
#   SET other:123 "test"    # Should fail for session_service
