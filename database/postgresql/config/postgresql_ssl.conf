# ============================================
# POSTGRESQL SSL CONFIGURATION
# ============================================
# Additional PostgreSQL configuration for SSL/TLS connections
# This file should be included in main postgresql.conf
#
# USAGE: Add to postgresql.conf:
#   include = '/path/to/postgresql_ssl.conf'
#
# Or mount this file in Docker and use it directly
# ============================================

# Enable SSL/TLS
ssl = on

# SSL Certificate Files
# These paths should match where certificates are mounted in Docker
ssl_cert_file = '/var/lib/postgresql/ssl/server.crt'
ssl_key_file = '/var/lib/postgresql/ssl/server.key'
ssl_ca_file = '/var/lib/postgresql/ssl/root.crt'

# SSL Cipher Configuration (strong ciphers only)
ssl_ciphers = 'HIGH:MEDIUM:+3DES:!aNULL:!eNULL'

# Minimum SSL Protocol Version
ssl_min_protocol_version = 'TLSv1.2'

# SSL Preferences
ssl_prefer_server_ciphers = on

# Connection Settings for SSL
# 'require' - client must use SSL
# 'prefer' -  SSL if possible, plaintext if not (NOT RECOMMENDED for production)
# 'allow' - Start with non-SSL, upgrade to SSL if possible
# 'disable' - No SSL

# For development, we use 'prefer' to allow non-SSL connections
# For production, change to 'require'
# Note: This is controlled per-connection in pg_hba.conf

#============================================
# CLIENT AUTHENTICATION (pg_hba.conf style)
#============================================
# You should also update pg_hba.conf to require SSL:
#
# # TYPE  DATABASE   USER     ADDRESS        METHOD    OPTIONS
# hostssl all        all      0.0.0.0/0      md5
# hostssl all        all      ::/0           md5
#
# The 'hostssl' keyword requires SSL connections
#============================================

# Performance Settings (optional)
# SSL connections use more CPU, so you may need to adjust:
max_connections = 200
shared_buffers = 256MB
effective_cache_size = 1GB
maintenance_work_mem = 64MB
checkpoint_completion_target = 0.9
wal_buffers = 16MB
default_statistics_target = 100
random_page_cost = 1.1
effective_io_concurrency = 200
work_mem = 4MB
min_wal_size = 1GB
max_wal_size = 4GB

# Logging
logging_collector = on
log_directory = 'log'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
log_connections = on
log_disconnections = on
log_duration = on
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '
log_statement = '

mod'
log_min_duration_statement = 1000  # Log queries taking longer than 1 second

# Security
# Don't show error details to clients (production)
client_min_messages = notice
