# =============================================================================
# Analytics Service Environment Configuration
# =============================================================================
# Copy this file to .env and fill in the values
# NEVER commit .env files with actual secrets!
# =============================================================================

# -----------------------------------------------------------------------------
# Service Configuration
# -----------------------------------------------------------------------------
NODE_ENV=development
PORT=3008
HOST=0.0.0.0
SERVICE_NAME=analytics-service

# -----------------------------------------------------------------------------
# Security - JWT Authentication (REQUIRED - no defaults!)
# -----------------------------------------------------------------------------
# Get from auth-service or secret manager
JWT_SECRET=
JWT_ISSUER=tickettoken-auth
JWT_AUDIENCE=tickettoken-services
JWT_ALGORITHM=RS256
# Public key for RS256 verification (PEM format, base64 encoded)
JWT_PUBLIC_KEY=

# -----------------------------------------------------------------------------
# Service-to-Service Authentication (REQUIRED)
# -----------------------------------------------------------------------------
INTERNAL_AUTH_SECRET=
INTERNAL_SERVICE_ID=analytics-service

# -----------------------------------------------------------------------------
# PostgreSQL Database (REQUIRED)
# -----------------------------------------------------------------------------
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_NAME=analytics
DATABASE_USER=
DATABASE_PASSWORD=
DATABASE_POOL_MIN=2
DATABASE_POOL_MAX=10
# Enable SSL in production!
DATABASE_SSL=false
DATABASE_SSL_CA=
DATABASE_SSL_CERT=
DATABASE_SSL_KEY=

# -----------------------------------------------------------------------------
# Redis Configuration (REQUIRED)
# -----------------------------------------------------------------------------
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
# Enable TLS in production!
REDIS_TLS=false
REDIS_TLS_VERIFY=true
# For Redis Sentinel (optional)
# REDIS_SENTINEL_HOSTS=sentinel1:26379,sentinel2:26379,sentinel3:26379
# REDIS_SENTINEL_MASTER=mymaster

# -----------------------------------------------------------------------------
# InfluxDB Configuration (REQUIRED for time-series analytics)
# -----------------------------------------------------------------------------
INFLUXDB_URL=http://localhost:8086
INFLUXDB_TOKEN=
INFLUXDB_ORG=tickettoken
INFLUXDB_BUCKET=analytics
INFLUXDB_TIMEOUT=30000

# -----------------------------------------------------------------------------
# MongoDB Configuration (Optional - for document storage)
# -----------------------------------------------------------------------------
# MONGODB_URI=mongodb://localhost:27017/analytics
# MONGODB_DATABASE=analytics

# -----------------------------------------------------------------------------
# Privacy & Compliance
# -----------------------------------------------------------------------------
# Salt for pseudonymization (REQUIRED - generate securely!)
PRIVACY_SALT=
# Data retention in days
DATA_RETENTION_DAYS=365
# GDPR compliance mode
GDPR_MODE=true

# -----------------------------------------------------------------------------
# Rate Limiting
# -----------------------------------------------------------------------------
RATE_LIMIT_MAX=100
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_SKIP_SUCCESSFUL_REQUESTS=false

# -----------------------------------------------------------------------------
# Cron Jobs / Scheduled Tasks
# -----------------------------------------------------------------------------
# RFM calculation schedule (cron format)
RFM_CALCULATION_SCHEDULE=0 2 * * *
# Report generation schedule
REPORT_GENERATION_SCHEDULE=0 3 * * *
# Enable distributed locking for cron
CRON_LOCK_TTL=3600000

# -----------------------------------------------------------------------------
# Logging
# -----------------------------------------------------------------------------
LOG_LEVEL=info
LOG_FORMAT=json
# Enable PII redaction (should be true in production)
LOG_REDACT_PII=true

# -----------------------------------------------------------------------------
# Metrics & Monitoring
# -----------------------------------------------------------------------------
METRICS_ENABLED=true
METRICS_PORT=9090
HEALTH_CHECK_INTERVAL=30000

# -----------------------------------------------------------------------------
# Feature Flags
# -----------------------------------------------------------------------------
FEATURE_REAL_TIME_ANALYTICS=true
FEATURE_CUSTOMER_INSIGHTS=true
FEATURE_PREDICTIVE_ANALYTICS=false

# -----------------------------------------------------------------------------
# External Services
# -----------------------------------------------------------------------------
# Auth service for token validation
AUTH_SERVICE_URL=http://auth-service:3001
# Event service for event data
EVENT_SERVICE_URL=http://event-service:3002
# Notification service for alerts
NOTIFICATION_SERVICE_URL=http://notification-service:3007

# -----------------------------------------------------------------------------
# Cache Configuration
# -----------------------------------------------------------------------------
CACHE_TTL_SHORT=300
CACHE_TTL_MEDIUM=3600
CACHE_TTL_LONG=86400
CACHE_PREFIX=analytics

# -----------------------------------------------------------------------------
# Shutdown Configuration
# -----------------------------------------------------------------------------
SHUTDOWN_TIMEOUT_MS=30000
