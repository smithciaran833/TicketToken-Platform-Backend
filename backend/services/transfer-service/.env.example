# =============================================================================
# Transfer Service Environment Configuration
# =============================================================================
# Copy this file to .env and fill in the values
# NEVER commit .env files with real credentials!
# =============================================================================

# -----------------------------------------------------------------------------
# Service Configuration
# -----------------------------------------------------------------------------
NODE_ENV=development
PORT=3019
SERVICE_NAME=transfer-service
LOG_LEVEL=info

# -----------------------------------------------------------------------------
# Database Configuration (PostgreSQL)
# AUDIT: DB-H1, DB-H2, DB-H3
# -----------------------------------------------------------------------------
DB_HOST=localhost
DB_PORT=5432
DB_NAME=transfer_service
DB_USER=transfer_service
DB_PASSWORD=
DB_POOL_MIN=2
DB_POOL_MAX=20
DB_CONNECTION_TIMEOUT=10000
DB_STATEMENT_TIMEOUT=30000
DB_QUERY_TIMEOUT=30000
DB_IDLE_TIMEOUT=30000

# SSL Configuration (required in production)
DB_SSL=false
DB_SSL_REJECT_UNAUTHORIZED=true
DB_SSL_CA=

# -----------------------------------------------------------------------------
# Redis Configuration
# -----------------------------------------------------------------------------
REDIS_URL=redis://localhost:6379
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# -----------------------------------------------------------------------------
# JWT Authentication
# AUDIT: SEC-H1, S2S-H1, S2S-H2, S2S-H3
# -----------------------------------------------------------------------------
# JWT Algorithm (RS256 preferred for production)
JWT_ALGORITHM=RS256

# For RS256 (asymmetric) - JWKS endpoint
JWKS_URI=https://auth.tickettoken.io/.well-known/jwks.json

# For HS256 (symmetric) - retrieve from secrets manager
# JWT_SECRET is loaded from AWS Secrets Manager in production
# For local dev, you can set it here (NOT for production!)
# JWT_SECRET=your-development-only-secret-min-32-chars

# JWT Claims validation
JWT_ISSUER=tickettoken-auth-service
JWT_AUDIENCE=tickettoken-services
JWT_CLOCK_TOLERANCE=300

# -----------------------------------------------------------------------------
# Service-to-Service Authentication
# AUDIT: S2S-2, S2S-3
# -----------------------------------------------------------------------------
# Internal service shared secret (retrieved from secrets manager in prod)
# INTERNAL_SERVICE_SECRET=your-internal-service-secret

# Allowed calling services (comma-separated)
ALLOWED_SERVICES=api-gateway,ticket-service,notification-service,marketplace-service

# -----------------------------------------------------------------------------
# Solana Blockchain Configuration
# AUDIT: SEC-2, BC-1, BC-3, ERR-H6
# -----------------------------------------------------------------------------
# RPC Endpoints (multiple for failover)
SOLANA_RPC_URL=https://api.devnet.solana.com
SOLANA_RPC_URL_SECONDARY=
SOLANA_RPC_URL_TERTIARY=

# Or use JSON configuration for more options
# SOLANA_RPC_ENDPOINTS=[{"url":"https://rpc1.example.com","name":"primary","priority":1,"weight":3}]

# RPC Configuration
RPC_MAX_RETRIES=3
RPC_RETRY_DELAY=1000
RPC_REQUEST_TIMEOUT=30000
RPC_RATE_LIMIT_BACKOFF=60000
RPC_HEALTH_CHECK_INTERVAL=30000

# Solana Network
SOLANA_NETWORK=devnet

# Treasury Keypair (LOAD FROM SECRETS MANAGER IN PRODUCTION!)
# In production, set SECRETS_PROVIDER=aws and configure AWS credentials
# SOLANA_TREASURY_PRIVATE_KEY is loaded from secrets manager

# Metaplex settings
METAPLEX_PROGRAM_ID=metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s

# -----------------------------------------------------------------------------
# Secrets Management
# AUDIT: SEC-2, SEC-3, CFG-1, CFG-2
# -----------------------------------------------------------------------------
# Provider: aws, vault, or env (env only for development!)
SECRETS_PROVIDER=env

# AWS Secrets Manager
AWS_REGION=us-east-1
AWS_SECRETS_PREFIX=tickettoken/transfer-service

# HashiCorp Vault
VAULT_ADDR=http://localhost:8200
VAULT_TOKEN=
VAULT_SECRET_PATH=secret/data/transfer-service

# Secret names
JWT_SECRET_NAME=jwt-secret
SOLANA_TREASURY_SECRET_NAME=solana-treasury-key
DB_PASSWORD_SECRET_NAME=db-password

# -----------------------------------------------------------------------------
# Rate Limiting
# AUDIT: RL-1, RL-2, RL-H1
# -----------------------------------------------------------------------------
RATE_LIMIT_MAX=200
RATE_LIMIT_WINDOW=60000

# Endpoint-specific limits (per user per minute)
RATE_LIMIT_TRANSFERS=10
RATE_LIMIT_BATCH_TRANSFERS=2
RATE_LIMIT_BLOCKCHAIN_OPS=3

# -----------------------------------------------------------------------------
# Webhook Configuration
# AUDIT: S2S-H4, S2S-H5, EXT-H1
# -----------------------------------------------------------------------------
WEBHOOK_TIMEOUT=10000
WEBHOOK_MAX_RETRIES=3
WEBHOOK_RETRY_DELAY=5000
WEBHOOK_TLS_VERIFY=true

# SSRF protection - allowed hosts (comma-separated)
WEBHOOK_ALLOWED_HOSTS=api.tickettoken.io,webhook.tickettoken.io

# Dead letter queue
WEBHOOK_DLQ_ENABLED=true
WEBHOOK_DLQ_MAX_AGE=604800

# -----------------------------------------------------------------------------
# External Service URLs
# -----------------------------------------------------------------------------
TICKET_SERVICE_URL=http://localhost:3004
USER_SERVICE_URL=http://localhost:3001
NOTIFICATION_SERVICE_URL=http://localhost:3007
AUTH_SERVICE_URL=http://localhost:3002

# -----------------------------------------------------------------------------
# Monitoring & Observability
# AUDIT: LOG-H5, LOG-H6
# -----------------------------------------------------------------------------
# OpenTelemetry
OTEL_ENABLED=false
OTEL_SERVICE_NAME=transfer-service
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318

# Prometheus metrics
METRICS_ENABLED=true
METRICS_PORT=9019

# Health check
HEALTH_CHECK_INTERVAL=30000

# -----------------------------------------------------------------------------
# Feature Flags
# -----------------------------------------------------------------------------
FEATURE_BLOCKCHAIN_TRANSFERS=true
FEATURE_BATCH_TRANSFERS=true
FEATURE_GIFT_TRANSFERS=true

# -----------------------------------------------------------------------------
# Development Only
# -----------------------------------------------------------------------------
# Enable debug mode (NEVER in production)
DEBUG=false

# Bypass auth for local testing (NEVER in production)
BYPASS_AUTH=false

# Use test accounts
USE_TEST_ACCOUNTS=false
