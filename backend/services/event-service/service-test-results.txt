
> @tickettoken/event-service@1.0.0 test
> jest tests/unit/services/

ts-jest[ts-jest-transformer] (WARN) Define `ts-jest` config under `globals` is deprecated. Please do
transform: {
    <transform_regex>: ['ts-jest', { /* ts-jest config goes here in Jest */ }],
},
See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/presets#advanced
ts-jest[config] (WARN) 
    The "ts-jest" config option "isolatedModules" is deprecated and will be removed in v30.0.0. Please use "isolatedModules: true" in /home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/tsconfig.json instead, see https://www.typescriptlang.org/tsconfig/#isolatedModules
  
FAIL tests/unit/services/pricing.service.test.ts
  ● Pricing Service › getEventPricing › should get pricing for event

    expect(received).toHaveLength(expected)

    Expected length: 2
    Received length: 0
    Received array:  []

      50 |         tenant_id: 'tenant-1' 
      51 |       });
    > 52 |       expect(result).toHaveLength(2);
         |                      ^
      53 |     });
      54 |   });
      55 |

      at Object.<anonymous> (tests/unit/services/pricing.service.test.ts:52:22)

  ● Pricing Service › createPricing › should throw ValidationError for missing event_id

    expect(received).rejects.toThrow(expected)

    Expected constructor: ValidationError
    Received constructor: TypeError

    Received message: "Cannot read properties of undefined (reading 'id')"

          78 |       .returning('*');
          79 |
        > 80 |     logger.info({ pricingId: pricing.id, eventId: data.event_id, tenantId }, 'Pricing created');
             |                                      ^
          81 |
          82 |     return this.parseDecimalFields(pricing);
          83 |   }

      at PricingService.createPricing (src/services/pricing.service.ts:80:38)
      at Object.<anonymous> (tests/unit/services/pricing.service.test.ts:93:7)
      at Object.toThrow (node_modules/expect/build/index.js:2155:20)
      at Object.<anonymous> (tests/unit/services/pricing.service.test.ts:95:17)

FAIL tests/unit/services/event.service.test.ts
  ● Event Service › createEvent › should create event

    TypeError: Cannot read properties of undefined (reading 'validateVenueAccess')

      42 |   async createEvent(data: any, authToken: string, userId: string, tenantId: string, requestInfo?: any): Promise<any> {
      43 |     // Validate venue access
    > 44 |     const hasAccess = await this.venueServiceClient.validateVenueAccess(data.venue_id, authToken);
         |                                                     ^
      45 |     if (!hasAccess) {
      46 |       throw new ValidationError([{ field: 'venue_id', message: 'Invalid venue or no access' }]);
      47 |     }

      at EventService.createEvent (src/services/event.service.ts:44:53)
      at Object.<anonymous> (tests/unit/services/event.service.test.ts:112:41)

  ● Event Service › updateEvent › should update event

    TypeError: Cannot read properties of undefined (reading 'validateVenueAccess')

      297 |
      298 |     // Validate venue access
    > 299 |     const hasAccess = await this.venueServiceClient.validateVenueAccess(event.venue_id, authToken);
          |                                                     ^
      300 |     if (!hasAccess) {
      301 |       throw new ValidationError([{ field: 'venue_id', message: 'No access to this venue' }]);
      302 |     }

      at EventService.updateEvent (src/services/event.service.ts:299:53)
      at Object.<anonymous> (tests/unit/services/event.service.test.ts:142:22)

  ● Event Service › deleteEvent › should soft delete event

    TypeError: Cannot read properties of undefined (reading 'validateVenueAccess')

      362 |
      363 |     // Validate venue access
    > 364 |     const hasAccess = await this.venueServiceClient.validateVenueAccess(event.venue_id, authToken);
          |                                                     ^
      365 |     if (!hasAccess) {
      366 |       throw new ValidationError([{ field: 'venue_id', message: 'No access to this venue' }]);
      367 |     }

      at EventService.deleteEvent (src/services/event.service.ts:364:53)
      at Object.<anonymous> (tests/unit/services/event.service.test.ts:170:7)

  ● Event Service › publishEvent › should publish event

    expect(received).toBe(expected) // Object.is equality

    Expected: "PUBLISHED"
    Received: "DRAFT"

      196 |
      197 |       expect(mockQueryBuilder.update).toHaveBeenCalled();
    > 198 |       expect(result.status).toBe('PUBLISHED');
          |                             ^
      199 |     });
      200 |   });
      201 |

      at Object.<anonymous> (tests/unit/services/event.service.test.ts:198:29)

PASS tests/unit/services/cache-integration.test.ts
  ● Console

    console.error
      Cache get error: Error: Redis error
          at Object.<anonymous> (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/tests/unit/services/cache-integration.test.ts:43:39)
          at Promise.finally.completed (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/jestAdapterInit.js:1556:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/jestAdapterInit.js:1496:10)
          at _callCircusTest (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/jestAdapterInit.js:1006:40)
          at _runTest (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/jestAdapterInit.js:946:3)
          at _runTestsForDescribeBlock (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/jestAdapterInit.js:1917:21)
          at jestAdapter (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-runner/build/index.js:275:16)
          at runTest (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-runner/build/index.js:343:7)

      22 |       return value ? JSON.parse(value) : null;
      23 |     } catch (error) {
    > 24 |       console.error('Cache get error:', error);
         |               ^
      25 |       return null;
      26 |     }
      27 |   }

      at ServiceCache.get (src/services/cache-integration.ts:24:15)
      at Object.<anonymous> (tests/unit/services/cache-integration.test.ts:45:22)

    console.error
      Cache set error: Error: Redis error
          at Object.<anonymous> (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/tests/unit/services/cache-integration.test.ts:65:41)
          at Promise.finally.completed (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/jestAdapterInit.js:1556:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/jestAdapterInit.js:1496:10)
          at _callCircusTest (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/jestAdapterInit.js:1006:40)
          at _runTest (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/jestAdapterInit.js:946:3)
          at _runTestsForDescribeBlock (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/jestAdapterInit.js:1917:21)
          at jestAdapter (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-runner/build/index.js:275:16)
          at runTest (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-runner/build/index.js:343:7)

      31 |       await this.client.setex(key, ttl, JSON.stringify(value));
      32 |     } catch (error) {
    > 33 |       console.error('Cache set error:', error);
         |               ^
      34 |     }
      35 |   }
      36 |

      at ServiceCache.set (src/services/cache-integration.ts:33:15)
      at Object.<anonymous> (tests/unit/services/cache-integration.test.ts:67:7)

    console.error
      Cache flush error: Error: Flush error
          at Object.<anonymous> (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/tests/unit/services/cache-integration.test.ts:122:43)
          at Promise.finally.completed (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/jestAdapterInit.js:1556:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/jestAdapterInit.js:1496:10)
          at _callCircusTest (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/jestAdapterInit.js:1006:40)
          at _runTest (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/jestAdapterInit.js:946:3)
          at _runTestsForDescribeBlock (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/jestAdapterInit.js:839:13)
          at _runTestsForDescribeBlock (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at _runTestsForDescribeBlock (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/jestAdapterInit.js:829:11)
          at run (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/jestAdapterInit.js:757:3)
          at runAndTransformResultsToJestFormat (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/jestAdapterInit.js:1917:21)
          at jestAdapter (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-runner/build/index.js:275:16)
          at runTest (/home/kevin/Desktop/TicketToken-Platform/backend/services/event-service/node_modules/jest-runner/build/index.js:343:7)

      71 |       await this.client.flushdb();
      72 |     } catch (error) {
    > 73 |       console.error('Cache flush error:', error);
         |               ^
      74 |     }
      75 |   }
      76 |

      at ServiceCache.flush (src/services/cache-integration.ts:73:15)
      at Object.<anonymous> (tests/unit/services/cache-integration.test.ts:124:7)

PASS tests/unit/services/capacity.service.test.ts

Test Suites: 2 failed, 2 passed, 4 total
Tests:       6 failed, 48 passed, 54 total
Snapshots:   0 total
Time:        0.736 s, estimated 1 s
Ran all test suites matching tests/unit/services/.
